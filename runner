#!/bin/bash
source /usr/bin/logger.sh
source /usr/bin/graceful-stop.sh

# Set up signal handler
trap 'graceful_stop' TERM

log.notice "Starting GitHub Actions Runner"

# Start the runner in background
/usr/bin/startup.sh &
RUNNER_PID=$!

# Wait for runner to exit
wait $RUNNER_PID
RUNNER_EXIT_CODE=$?

log.notice "Runner process exited with code ${RUNNER_EXIT_CODE}"

# Clean up .runner file if exists
if [ -f "${RUNNER_HOME}/.runner" ]; then
  log.notice "Removing .runner file"
  rm -f "${RUNNER_HOME}/.runner"
fi

log.notice "Exiting container"
exit $RUNNER_EXIT_CODE
