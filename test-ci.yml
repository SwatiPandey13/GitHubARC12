# [...] (keep everything above the Maven installation section)

# Install Maven 3.8.8 with certificate verification
RUN wget --no-check-certificate \
    https://archive.apache.org/dist/maven/maven-3/3.8.8/binaries/apache-maven-3.8.8-bin.tar.gz \
    -O /tmp/maven.tar.gz && \
    tar -xzf /tmp/maven.tar.gz -C /opt && \
    ln -s /opt/apache-maven-3.8.8 /opt/maven && \
    rm /tmp/maven.tar.gz

# ▼▼▼ Add this section right after Maven installation ▼▼▼
# Configure Maven settings with proper permissions
RUN mkdir -p /opt/maven/conf && \
    chown -R 1001:0 /opt/maven && \
    chmod -R g+rw /opt/maven
COPY settings.xml /opt/maven/conf/settings.xml
RUN chmod 644 /opt/maven/conf/settings.xml

# Set user-level Maven config directory
RUN mkdir -p /home/runner/.m2 && \
    chown -R 1001:0 /home/runner/.m2 && \
    chmod -R g+rw /home/runner/.m2 && \
    ln -s /opt/maven/conf/settings.xml /home/runner/.m2/settings.xml
# ▲▲▲ End of added section ▲▲▲

# Environment configuration (including all required vars from inspect output)
ENV JAVA_HOME=/usr/lib/jvm/jdk8 \
    JAVA_HOME_8=/usr/lib/jvm/jdk8 \
    JAVA_HOME_11=/usr/lib/jvm/jdk11 \
    MAVEN_HOME=/opt/maven \
    MAVEN_CONFIG=/opt/maven/conf \  # ← Add this line
    PATH="${JAVA_HOME}/bin:${MAVEN_HOME}/bin:${PATH}:/home/runner:/usr/local/bin" \
    # [...] (rest of your existing ENV vars)

# [...] (keep the rest of your Dockerfile unchanged)
