# GitHub Runner Base Image
FROM artifactory.voya.net/docker-virtual/openshift/actions/actions-runner:latest

USER root

# 1. Install 'xz' using BusyBox static binary (for tar -xJf support)
RUN curl -k -L -o /bin/busybox https://busybox.net/downloads/binaries/1.36.0-i686/busybox && \
    chmod +x /bin/busybox && \
    ln -s /bin/busybox /bin/xz

# 2. Define Node.js versions to install
ENV NODE_VERSIONS="23.4.0 22.12.0 20.18.1 18.20.5"
ENV NODE_DIR=/opt/node

# 3. Create Node directory and install all versions
RUN mkdir -p $NODE_DIR && \
    for version in $NODE_VERSIONS; do \
      curl -k -fsSL https://nodejs.org/dist/v$version/node-v$version-linux-x64.tar.xz -o /tmp/node-$version.tar.xz && \
      mkdir -p $NODE_DIR/$version && \
      tar -xJf /tmp/node-$version.tar.xz -C $NODE_DIR/$version --strip-components=1 && \
      rm /tmp/node-$version.tar.xz; \
    done

# 4. Set default Node.js version
ENV DEFAULT_NODE_VERSION=20.18.1

# 5. Add symlinks to make default node/npm globally available
RUN ln -sf $NODE_DIR/$DEFAULT_NODE_VERSION/bin/node /usr/bin/node && \
    ln -sf $NODE_DIR/$DEFAULT_NODE_VERSION/bin/npm /usr/bin/npm && \
    ln -sf $NODE_DIR/$DEFAULT_NODE_VERSION/bin/npx /usr/bin/npx

# 6. Export path for Node.js
ENV PATH="$NODE_DIR/$DEFAULT_NODE_VERSION/bin:$PATH"

# 7. Validate
RUN node -v && npm -v

# 8. OpenShift compatible permissions
RUN chgrp -R 0 $NODE_DIR && chmod -R g=u $NODE_DIR

USER 1001
